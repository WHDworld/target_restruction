<?xml version="1.0"?>
<launch>
    <!-- ========== Launch Arguments ========== -->
    <!-- Configuration file path -->
    <arg name="config_file" default="$(find target_reconstruction)/config/default_params.yaml" />
    
    <!-- RViz visualization switch -->
    <arg name="use_rviz" default="true" doc="Launch RViz for visualization" />
    
    <!-- ========== Target Reconstruction Node ========== -->
    <node name="target_reconstruction_node" pkg="target_reconstruction" type="target_reconstruction_node" output="screen">
        
        <!-- Load all parameters from YAML -->
        <rosparam command="load" file="$(arg config_file)" />
        
        <!-- Override output file path (use package path) -->
        <param name="output/file" value="$(find target_reconstruction)/output/target_reconstruction.ply" />
        
        <!-- ========== Topic Remapping ========== -->
        <!-- Topic names are configured in YAML file (topics section) -->
        <!-- You can override specific topics here if needed -->
        
        <!-- Example: Remap to actual hardware topics -->
        <remap from="/camera/color/image_raw" to="/realsense/depth_camera/color/image_raw" />
        <remap from="/camera/depth/image_raw" to="/realsense/depth_camera/depth/image_raw" />
        <remap from="/yolo/person_mask" to="/yolo/person_mask" />
        <remap from="/camera/odom" to="/mavros/local_position/odom" />
        
        <!-- Note: 
             1. Topics are first read from YAML config file
             2. /camera/odom 提供的是无人机本体（IMU）坐标系的位姿
             3. 系统内部会自动转换到相机坐标系
             4. 外参标定在 YAML 文件的 extrinsics 部分配置
             5. 位姿从真值系统（如 Gazebo、Vicon、FAST-LIVO2 等）获取，无需运行额外的定位算法
        -->
    </node>
    
    <!-- ========== RViz Visualization ========== -->
    <!-- Launch RViz with predefined configuration -->
    <!-- Usage: 
         - Launch with RViz (default): roslaunch target_reconstruction target_reconstruction.launch
         - Launch without RViz: roslaunch target_reconstruction target_reconstruction.launch use_rviz:=false
    -->
    <node if="$(arg use_rviz)" 
          name="rviz" 
          pkg="rviz" 
          type="rviz" 
          args="-d $(find target_reconstruction)/rviz/default.rviz" 
          output="screen"
          respawn="false" />
    
</launch>

